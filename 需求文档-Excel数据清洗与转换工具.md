# Excel数据清洗与转换工具需求文档

## 1. 项目概述

### 1.1 项目背景
医院信息系统中的药品使用数据分散在多个Excel表格中，包括门诊明细表、住院明细表等。这些数据需要被整合、清洗并转换为标准格式，以便于后续的分析和报告生成。

### 1.2 项目目标
开发一个Excel数据清洗与转换工具，将明细表、门诊/住院病人表格中的数据清洗后放在目标表格相应字段下，并支持表格上传自动转换功能。

## 2. 功能需求

### 2.1 数据源
- **明细表**：包含科室名称(B列)、药品名称(E列)、数量(M列)、总金额(O列)等信息
- **门诊病人表**：包含科室名称和门诊病人数量
- **住院病人表**：包含科室名称和住院病人数量

### 2.2 目标表格
- **药品使用信息sheet**：包含科室ID(C列)、科室名称(D列)、门诊/病房标识(E列)、医院药品名称(B列)、使用量(G列)、使用金额(H列)等
- **科室基础信息sheet**：包含科室三层结构信息
- **药费及人次sheet**：包含科室ID、住院/门诊病人数量、科室总金额等

### 2.3 核心功能

#### 2.3.1 数据映射与转换
1. **科室名称映射**：
   - 将明细表中的科室名称(B列)对应到目标表格"药品使用信息"sheet中的科室名称(D列)
   - 根据科室名称判断并填入"门诊"或"病房"(E列)

2. **药品信息映射**：
   - 将明细表中的药品名称(E列)映射到目标表格"药品使用信息"sheet中的医院药品名称(B列)
   - 将明细表中的数量(M列)映射到目标表格"药品使用信息"sheet中的使用量(G列)
   - 将明细表中的总金额(O列)映射到目标表格"药品使用信息"sheet中的使用金额(H列)

#### 2.3.2 科室结构构建
1. **三层结构建立**：
   - 根据明细表中的科室名称(B列)建立科室三层结构(全院→科室→门诊/病房)
   - 将科室三层结构信息填入目标表格"科室基础信息"sheet
   - 将科室ID填入目标表格"药品使用信息"sheet的科室ID(C列)

#### 2.3.3 数据汇总与统计
1. **病人数量统计**：
   - 根据科室三层结构中的二级结构ID，将住院病人和门诊病人人数表格求和
   - 将汇总数据填入目标表格"药费及人次"sheet

2. **金额汇总**：
   - 根据科室ID匹配，将明细表中的科室总金额汇总
   - 将汇总金额填入目标表格"药费及人次"sheet

### 2.4 用户界面需求

#### 2.4.1 文件上传界面
1. **源文件上传**：
   - 支持上传明细表Excel文件
   - 支持上传门诊病人表Excel文件
   - 支持上传住院病人表Excel文件
   - 支持批量上传多个文件

2. **文件预览**：
   - 上传后显示文件内容预览
   - 允许用户确认数据正确性

#### 2.4.2 转换配置界面
1. **列映射配置**：
   - 允许用户确认或修改默认的列映射关系
   - 提供拖拽或下拉选择方式进行映射

2. **科室结构配置**：
   - 允许用户查看和调整自动生成的科室三层结构
   - 提供添加、编辑、删除科室的功能

#### 2.4.3 转换执行与结果界面
1. **转换进度显示**：
   - 显示数据转换的实时进度
   - 提供取消转换的选项

2. **结果预览与导出**：
   - 转换完成后显示结果预览
   - 提供导出功能，支持Excel格式

## 3. 非功能需求

### 3.1 性能需求
- 支持处理大型Excel文件(10MB以上)
- 转换过程响应时间不超过30秒(标准数据量)

### 3.2 兼容性需求
- 支持Excel 2010及以上版本的文件格式(.xlsx, .xls)
- 支持Windows 10及以上操作系统

### 3.3 安全性需求
- 所有数据处理在本地完成，不上传至外部服务器
- 临时文件在处理完成后自动删除

### 3.4 可用性需求
- 提供简洁明了的用户界面
- 提供详细的操作指南和帮助文档
- 提供错误处理和恢复机制

## 4. 系统架构

### 4.1 组件设计
1. **文件处理模块**：负责Excel文件的读取和写入
2. **数据转换模块**：负责数据清洗和映射
3. **科室结构管理模块**：负责科室三层结构的建立和管理
4. **数据汇总模块**：负责数据统计和汇总
5. **用户界面模块**：负责与用户交互

### 4.2 技术选型
- 开发语言：C#
- UI框架：Windows Forms或WPF
- Excel处理库：EPPlus或NPOI
- 数据存储：内存数据表(DataTable)

## 5. 项目计划

### 5.1 开发阶段
1. **需求分析与设计**：2周
2. **核心功能开发**：3周
3. **用户界面开发**：2周
4. **测试与修复**：2周
5. **文档编写与培训**：1周

### 5.2 交付物
1. 可执行的Excel数据清洗与转换工具
2. 用户手册和操作指南
3. 示例数据和转换模板
4. 源代码和技术文档

## 6. 验收标准

### 6.1 功能验收
1. 能够正确读取源Excel文件
2. 能够正确建立科室三层结构
3. 能够正确映射和转换数据
4. 能够正确汇总统计数据
5. 能够生成符合要求的目标Excel文件

### 6.2 性能验收
1. 能够处理10MB以上的Excel文件
2. 标准数据量的转换时间不超过30秒

### 6.3 用户体验验收
1. 界面操作流畅，无卡顿
2. 错误提示清晰明了
3. 用户能够轻松完成所有操作 